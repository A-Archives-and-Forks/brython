<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>
body,td,th{
    font-family:sans-serif;
    font-size:12px;
}
</style>

<title>Generated PEG parser test</title>

<script type="text/javascript" src="/src/brython_builtins.js"></script>

<script type="text/javascript" src="/src/py_ast_classes.js"></script>
<script type="text/javascript" src="/src/stdlib_paths.js"></script>
<script type="text/javascript" src="/src/unicode_data.js"></script>
<script type="text/javascript" src="/src/version_info.js"></script>


<script type="text/javascript" src="/src/py_tokens.js"></script>
<script type="text/javascript" src="/src/python_tokenizer.js"></script>
<script type="text/javascript" src="/src/py_ast.js"></script>
<script type="text/javascript" src="/src/py2js.js"></script>
<script type="text/javascript" src="/src/loaders.js"></script>
<script type="text/javascript" src="/src/py_utils.js"></script>
<script type="text/javascript" src="/src/py_object.js"></script>
<script type="text/javascript" src="/src/py_type.js"></script>
<script type="text/javascript" src="/src/py_functions.js"></script>
<script type="text/javascript" src="/src/py_builtin_functions.js"></script>
<script type="text/javascript" src="/src/py_sort.js"></script>
<script type="text/javascript" src="/src/py_exceptions.js"></script>
<script type="text/javascript" src="/src/py_range_slice.js"></script>
<script type="text/javascript" src="/src/py_bytes.js"></script>
<script type="text/javascript" src="/src/py_set.js"></script>
<script type="text/javascript" src="/src/py_import.js"></script>
<script type="text/javascript" src="/src/py_string.js"></script>
<script type="text/javascript" src="/src/py_int.js"></script>
<script type="text/javascript" src="/src/py_long_int.js"></script>
<script type="text/javascript" src="/src/py_float.js"></script>
<script type="text/javascript" src="/src/py_complex.js"></script>
<script type="text/javascript" src="/src/py_dict.js"></script>
<script type="text/javascript" src="/src/py_list.js"></script>
<script type="text/javascript" src="/src/js_objects.js"></script>
<script type="text/javascript" src="/src/py_generator.js"></script>
<script type="text/javascript" src="/src/py_dom.js"></script>
<script type="text/javascript" src="/src/py_pattern_matching.js"></script>
<script type="text/javascript" src="/src/async.js"></script>
<script type="text/javascript" src="/src/py_flags.js"></script>
<script type="text/javascript" src="/src/builtin_modules.js"></script>
<script type="text/javascript" src="/src/ast_to_js.js"></script>
<script type="text/javascript" src="/src/symtable.js"></script>

<!-- scripts for PEG parser -->
<script type="text/javascript" src="/src/action_helpers.js"></script>
<script type="text/javascript" src="/src/string_parser.js"></script>
<script type="text/javascript" src="/src/number_parser.js"></script>
<script type="text/javascript" src="/src/python_parser.js"></script>
<script type="text/javascript" src="/src/pegen.js"></script>
<script type="text/javascript" src="/src/gen_parse.js"></script>

<script type="text/javascript" src="/src/brython_ready.js"></script>

</head>
<body>
<h2>Test generated PEG parser</h2>

<p>Open browser console to see the time taken to parse /src/Lib/pydatetime.py

<script>
var filename = '/src/Lib/_pydatetime.py'
fetch(filename).then(function(ev){
  ev.text().then(function(data){
    parse(filename, data)
  })
})

function parse(filename, src){
    var timer = globalThis.performance
    var t = timer.now()
    $B.tokenizer(src, filename, 'file')
    var t0 = timer.now()
    console.log('tokenizer', t0 - t)
    var parser = new $B.Parser(src, filename, 'file'),
        _ast = $B._PyPegen.run_parser(parser)

    var t1 = timer.now()
    console.log('parser, including tokenizer', t1 - t0)
    var future = $B.future_features(_ast, filename)
    var symtable = $B._PySymtable_Build(_ast, filename, future)
    var t2 = timer.now()
    console.log('symtable', t2 - t1)
    var js_obj = $B.js_from_root({ast: _ast,
                                  symtable,
                                  filename,
                                  src})
    var t3 = timer.now()
    console.log('to js', t3 - t2)
    var js_from_ast = js_obj.js
}

</script>

</body>
</html>
